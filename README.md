# Tuga Compiler and Virtual Machine

## ğŸ“˜ Project Overview
This project implements a compiler for the "Tuga" programming language, along with a virtual machine that executes the generated bytecode. The compiler was developed in stages across three university assignments, each adding new language features and VM capabilities.

> âš ï¸ This is a university project â€” mistakes are part of the process. Nothing has been added or fixed after submission.

> âš ï¸ The code is mostly written in English, but some parts may mix Portuguese and English.

> âš ï¸ The assignments are written in Portuguese.

### ğŸ”§ Tools
- [ANTLR](https://www.antlr.org/)

## ğŸ—‚ï¸ Project Structure

The project consists of 2 key components:

### ğŸ› ï¸ Compiler:
- ğŸ§¾ [Lexer and Parser (ANTLR4)](src/ErrorListener/MyErrorListener.java)
- ğŸ§  [Semantic Analyzer](src/ErrorListener/TypeChecker.java)
- âš™ï¸ [Code Generator](src/CodeGenerator/CodeGen.java) (Generate bytecode)

### ğŸ§® Virtual Machine:
- ğŸ“œ [Instruction set](src/VM/OpCode.java)
- ğŸƒ [Execution Engine](src/VM/vm.java)

### ğŸš€ Main:
- ğŸ§ª [Compile and Run entry point](src/TugaCompileAndRun.java)


## âœ¨ Key Features & Implementation Details

- Global Variables **[Stored in Globals array]**
- Local Variables **[Managed via stack frames]**
- Function Calls & Returns
- Type Conversion & Operations
- Control Flow **[While, If-else]**
- Error Handling
- Debug & Trace Mode

## ğŸ’» Language Overview

### ğŸ—ï¸ Program Structure
- A Tuga program starts with zero or more global variable declarations.
- Followed by one or more function declarations.
- The program ends after all functions are declared.
- The program needs to have a **principal** (main) function 

### ğŸ“š Data Types
- inteiro â€” Integer numbers
- real â€” Floating-point numbers
- booleano â€” Boolean values **[Verdadeiro (True) / Falso (False)]**
- string

### ğŸ”¢ Arithmetic Operators
| Operator       | Symbol | Example | Description            |
| -------------- | ------ | ------- | ---------------------- |
| Addition       | `+`    | `a + b` | Sums two numbers       |
| Subtraction    | `-`    | `a - b` | Subtracts `b` from `a` |
| Multiplication | `*`    | `a * b` | Multiplies numbers     |
| Division       | `/`    | `a / b` | Divides `a` by `b`     |
| Mod         | `%`    | `a % b` | Remainder of `a / b`   |


### ğŸ§® Relational Operators
| Operator         | Symbol      | Example         | Description                     |
| ---------------- | ----------- | --------------- | ------------------------------- |
| Less than        | `<`         | `a < b`         | True if `a` is less than `b`    |
| Greater than     | `>`         | `a > b`         | True if `a` is greater than `b` |
| Less or equal    | `<=`        | `a <= b`        | True if `a` â‰¤ `b`               |
| Greater or equal | `>=`        | `a >= b`        | True if `a` â‰¥ `b`               |
| Equal            | `igual`     | `a igual b`     | True if `a` equals `b`          |
| Not equal        | `diferente` | `a diferente b` | True if `a` â‰  `b`               |


### ğŸ§  Logical Operators
| Operator | Keyword | Example  | Description                       |
| -------- | ------- | -------- | --------------------------------- |
| AND      | `e`     | `a e b`  | True if both `a` and `b` are true |
| OR       | `ou`    | `a ou b` | True if either `a` or `b` is true |
| NOT      | `nao`   | `nao a`  | Inverts the truth value of `a`    |


### ğŸ—ƒï¸ Variable Declarations
```bash
x, y: inteiro;

nome: string;
```

### ğŸ§© Functions
Defined with the ``funcao`` keyword, with optional parameters and return type:

```
funcao sum2numbers(a: inteiro, b: inteiro): inteiro
inicio
    retorna a + b;
fim
```

### ğŸ“œ Statements
- ğŸ–¨ï¸ **Print:** ``escreve expr;`` â€” prints a value or expression.

- ğŸ“ **Assignment:** ``variable <- expression;`` â€” assigns an expression to a variable.

- ğŸ” **While loop:** 
```
enquanto (Condition)
inicio
	...
fim
```

- ğŸ”€ **If-Else:** 
```
se (Condition)
inicio
	...
fim
senao inicio
	...
fim
```

- ğŸ”™ **Return:** ``retorna expr;`` â€” returns a value from a function.

- â˜ï¸ **Function call:** ``functionName(args);``


ğŸ“ [Tuga programs examples](Examples/)

## â–¶ï¸ Execute Project

```bash
cd src
```

### ğŸ§± Compile


```bash
javac -cp ".;antlr-4.13.2-complete.jar" *.java ErrorListener/*.java ErrorListener/SymbolTable/*.java CodeGenerator/*.java VM/*.java VM/Instruction/*.java Tuga/*.java
```

### ğŸš€ Run
```bash 
java -cp ".;antlr-4.13.2-complete.jar" TugaCompileAndRun [file].Tuga [-flag]
```

### ğŸ³ï¸ Available Flags
```bash
-showLexerErrors 			# Show lexer errors
-showParserErrors 			# Show parser errors
-showTypeCheckingErrors 	# Show semantic errors
-allErrors 					# Show all errors
```
> ğŸ’¡ Combine flags to control which parts of the compilation process are printed.

### ğŸ Debug & Trace Mode

In [Main](src/TugaCompileAndRun.java), set the `trace` flag to `true`:
```bash
vm VM = new vm(bytecodes, true);
```

When ``trace`` is enabled, the VM logs:

- Current instruction
- Stack
- Global variables
- Frames

---

```
ğŸ« This project was developed as part of the "Compiladores" course module in the "Engenharia InformÃ¡tica" (Computer Science) degree.

ğŸ“ Institution: Universidade do Algarve - Portugal
ğŸ“… Year: 2025
ğŸ§‘â€ğŸ’» Author: Rodrigo Coelho
```