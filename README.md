# Tuga Compiler and Virtual Machine

## 📘 Project Overview
This project implements a compiler for the "Tuga" programming language, along with a virtual machine that executes the generated bytecode. The compiler was developed in stages across three university assignments, each adding new language features and VM capabilities.

> ⚠️ This is a university project — mistakes are part of the process. Nothing has been added or fixed after submission.

> ⚠️ The code is mostly written in English, but some parts may mix Portuguese and English.

> ⚠️ The assignments are written in Portuguese.

### 🔧 Tools
- [ANTLR](https://www.antlr.org/)

## 🗂️ Project Structure

The project consists of 2 key components:

### 🛠️ Compiler:
- 🧾 [Lexer and Parser (ANTLR4)](src/ErrorListener/MyErrorListener.java)
- 🧠 [Semantic Analyzer](src/ErrorListener/TypeChecker.java)
- ⚙️ [Code Generator](src/CodeGenerator/CodeGen.java) (Generate bytecode)

### 🧮 Virtual Machine:
- 📜 [Instruction set](src/VM/OpCode.java)
- 🏃 [Execution Engine](src/VM/vm.java)

### 🚀 Main:
- 🧪 [Compile and Run entry point](src/TugaCompileAndRun.java)


## ✨ Key Features & Implementation Details

- Global Variables **[Stored in Globals array]**
- Local Variables **[Managed via stack frames]**
- Function Calls & Returns
- Type Conversion & Operations
- Control Flow **[While, If-else]**
- Error Handling
- Debug & Trace Mode

## 💻 Language Overview

### 🏗️ Program Structure
- A Tuga program starts with zero or more global variable declarations.
- Followed by one or more function declarations.
- The program ends after all functions are declared.
- The program needs to have a **principal** (main) function 

### 📚 Data Types
- inteiro — Integer numbers
- real — Floating-point numbers
- booleano — Boolean values **[Verdadeiro (True) / Falso (False)]**
- string

### 🔢 Arithmetic Operators
| Operator       | Symbol | Example | Description            |
| -------------- | ------ | ------- | ---------------------- |
| Addition       | `+`    | `a + b` | Sums two numbers       |
| Subtraction    | `-`    | `a - b` | Subtracts `b` from `a` |
| Multiplication | `*`    | `a * b` | Multiplies numbers     |
| Division       | `/`    | `a / b` | Divides `a` by `b`     |
| Mod         | `%`    | `a % b` | Remainder of `a / b`   |


### 🧮 Relational Operators
| Operator         | Symbol      | Example         | Description                     |
| ---------------- | ----------- | --------------- | ------------------------------- |
| Less than        | `<`         | `a < b`         | True if `a` is less than `b`    |
| Greater than     | `>`         | `a > b`         | True if `a` is greater than `b` |
| Less or equal    | `<=`        | `a <= b`        | True if `a` ≤ `b`               |
| Greater or equal | `>=`        | `a >= b`        | True if `a` ≥ `b`               |
| Equal            | `igual`     | `a igual b`     | True if `a` equals `b`          |
| Not equal        | `diferente` | `a diferente b` | True if `a` ≠ `b`               |


### 🧠 Logical Operators
| Operator | Keyword | Example  | Description                       |
| -------- | ------- | -------- | --------------------------------- |
| AND      | `e`     | `a e b`  | True if both `a` and `b` are true |
| OR       | `ou`    | `a ou b` | True if either `a` or `b` is true |
| NOT      | `nao`   | `nao a`  | Inverts the truth value of `a`    |


### 🗃️ Variable Declarations
```bash
x, y: inteiro;

nome: string;
```

### 🧩 Functions
Defined with the ``funcao`` keyword, with optional parameters and return type:

```
funcao sum2numbers(a: inteiro, b: inteiro): inteiro
inicio
    retorna a + b;
fim
```

### 📜 Statements
- 🖨️ **Print:** ``escreve expr;`` — prints a value or expression.

- 📝 **Assignment:** ``variable <- expression;`` — assigns an expression to a variable.

- 🔁 **While loop:** 
```
enquanto (Condition)
inicio
	...
fim
```

- 🔀 **If-Else:** 
```
se (Condition)
inicio
	...
fim
senao inicio
	...
fim
```

- 🔙 **Return:** ``retorna expr;`` — returns a value from a function.

- ☎️ **Function call:** ``functionName(args);``


📁 [Tuga programs examples](Examples/)

## ▶️ Execute Project

```bash
cd src
```

### 🧱 Compile


```bash
javac -cp ".;antlr-4.13.2-complete.jar" *.java ErrorListener/*.java ErrorListener/SymbolTable/*.java CodeGenerator/*.java VM/*.java VM/Instruction/*.java Tuga/*.java
```

### 🚀 Run
```bash 
java -cp ".;antlr-4.13.2-complete.jar" TugaCompileAndRun [file].Tuga [-flag]
```

### 🏳️ Available Flags
```bash
-showLexerErrors 			# Show lexer errors
-showParserErrors 			# Show parser errors
-showTypeCheckingErrors 	# Show semantic errors
-allErrors 					# Show all errors
```
> 💡 Combine flags to control which parts of the compilation process are printed.

### 🐞 Debug & Trace Mode

In [Main](src/TugaCompileAndRun.java), set the `trace` flag to `true`:
```bash
vm VM = new vm(bytecodes, true);
```

When ``trace`` is enabled, the VM logs:

- Current instruction
- Stack
- Global variables
- Frames

---

```
🏫 This project was developed as part of the "Compiladores" course module in the "Engenharia Informática" (Computer Science) degree.

🎓 Institution: Universidade do Algarve - Portugal
📅 Year: 2025
🧑‍💻 Author: Rodrigo Coelho
```